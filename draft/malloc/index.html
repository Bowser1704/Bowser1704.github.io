<!DOCTYPE html>
<html lang="zh-CN"><meta charset="utf-8">
<meta name="HandheldFriendly" content="True">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="referrer" content="no-referrer">
<meta name="renderer" content="webkit">
<meta name="force-rendering" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="no-transform">
<meta name="format-detection" content="telephone=no,email=no,address=no">
<meta name="generator" content="Hugo 0.70.0" />


<title> - Bowser</title>


<link rel="stylesheet" href="/css/style.css">

<link href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:400,700&display=swap&subset=chinese-simplified" rel="stylesheet" />
<link rel="canonical" href="https://bowser1704.github.io/draft/malloc/">
<link rel="shortcut icon" href="/favicon.jpg">

<meta itemprop="name" content="">
<meta itemprop="description" content="几种在堆上分配内存的方式 void *malloc(size_t size); void free(void *ptr); void *calloc(size_t nmemb, size_t size); void *realloc(void *ptr, size_t size); void *reallocarray(void *ptr, size_t nmemb, size_t size); 1. malloc void *malloc(int n);//n为要分配的字节数 该函数必须配合memset初始化 int">

<meta itemprop="wordCount" content="697">



<meta itemprop="keywords" content="" />
<meta property="og:title" content="" />
<meta property="og:description" content="几种在堆上分配内存的方式 void *malloc(size_t size); void free(void *ptr); void *calloc(size_t nmemb, size_t size); void *realloc(void *ptr, size_t size); void *reallocarray(void *ptr, size_t nmemb, size_t size); 1. malloc void *malloc(int n);//n为要分配的字节数 该函数必须配合memset初始化 int" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bowser1704.github.io/draft/malloc/" />


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="几种在堆上分配内存的方式 void *malloc(size_t size); void free(void *ptr); void *calloc(size_t nmemb, size_t size); void *realloc(void *ptr, size_t size); void *reallocarray(void *ptr, size_t nmemb, size_t size); 1. malloc void *malloc(int n);//n为要分配的字节数 该函数必须配合memset初始化 int"/>
<body class="font-sans">
    <div class="flex flex-col md:flex-row md:w-4/5 mx-auto py-5 min-h-screen">
<header
    class="flex flex-col relative border-black border-b-4 md:border-b-0 md:border-r-2 pb-6 mx-4 md:mx-0 md:w-1/5 md:text-right md:pr-8 bg-white md:text-center">
    <link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/vs.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"></script>
    <div>
        <h1 id="header_logo" class="text-3xl md:my-12 mt-4 md:mb-12"><a href="https://bowser1704.github.io">Bowser</a></h1>
        <p class="font-thin italic">There is no dark side of the Moon. It&#39;s all dark, really.</p>
    </div>
    <input id="menu-check" type="checkbox" class="hidden" />
    <label id="menu-label" for="menu-check"
        class="absolute right-0 text-right md:hidden  inline-block py-4 h-12 cursor-pointer mt-10 text-xl text-gray-900">
        <span class="icon close-icon">✕</span>
        <span class="icon open-icon">☰</span>
        <span class="text">MENU</span>
    </label>
    <nav id="menu" class="my-2 w-full md:flex-row-reverse hidden md:block">
        <ul class="list-none pl-0 mx-auto justify-center  max-w-xs">
            
            
            <li class="my-4 border-black text-center md:text-right border-b-2 md:border-none pb-1">
                <a class="py-4 md:border-black md:border-b-2  md:pb-1" href="/blog/">博客</a>
            </li>
            
            <li class="my-4 border-black text-center md:text-right border-b-2 md:border-none pb-1">
                <a class="py-4 md:border-black md:border-b-2  md:pb-1" href="/note/">笔记</a>
            </li>
            
            <li class="my-4 border-black text-center md:text-right border-b-2 md:border-none pb-1">
                <a class="py-4 md:border-black md:border-b-2  md:pb-1" href="/about/">关于</a>
            </li>
            
        </ul>
    </nav>
</header>
<main class="flex-1 p-4 ">
<article itemscope itemtype="http://schema.org/Article" class="max-w-3xl mx-auto leading-relaxed">
    <header class="flex flex-col meta">
<div class="flex flex-col md:flex-row justify-between ">
    
    
</div>
<h1 itemprop="name" class="text-center text-4xl my-4 md:my-6"></h1>
        
        <h3 class="text-center text-2xl">
            
            <span itemprop="author" itemscope itemtype="http://schema.org/Person">
                <span itemprop="name">Bowser</span>
                
                
        </h3>
        
    </header>
    <hr class="block my-10 mx-auto max-w-xs h-px border-t border-black">
    <div itemprop="articleBody" class="content markdown">
        <p>几种在堆上分配内存的方式</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">malloc</span>(size_t size);
<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">free</span>(<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>ptr);
<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">calloc</span>(size_t nmemb, size_t size);
<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">realloc</span>(<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>ptr, size_t size);
<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">reallocarray</span>(<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>ptr, size_t nmemb, size_t size);
</code></pre></div><h3 id="1-malloc">1. malloc</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">malloc</span>(<span style="color:#66d9ef">int</span> n);<span style="color:#75715e">//n为要分配的字节数
</span></code></pre></div><p>该函数必须配合memset初始化</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>p;
p <span style="color:#f92672">=</span> (<span style="color:#66d9ef">int</span><span style="color:#f92672">*</span>)malloc(<span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>));
memset(p, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>));
</code></pre></div><h3 id="2-calloc">2. calloc</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">calloc</span>(<span style="color:#66d9ef">int</span> n, <span style="color:#66d9ef">int</span> size);
<span style="color:#75715e">//n为要分配的元素个数，size为元素所占的字节数。
</span></code></pre></div><p>该函数默认初始化都为0，不需要memset手动初始化，适合用于数组创建。</p>
<h3 id="3-realloc">3. realloc</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">realloc</span>(<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>p, <span style="color:#66d9ef">int</span> n);
<span style="color:#75715e">//p是堆上一块内存的地址，也就是我们分配的
</span><span style="color:#75715e">//n是我们将p指向的内存空间大小字节数设置为n，新起一块大小为n的内存，并且将数据给复制过去。
</span><span style="color:#75715e">//但是如果p指向的内存空间大于或等于n，不变。
</span></code></pre></div><h3 id="4-free">4. free</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">free</span>(<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>p);
<span style="color:#75715e">//释放该指针所指向的内容，但是该指针还是存在的，其实他是在栈上的，只不过指向的空间是在堆上。
</span><span style="color:#75715e">//所以我们为了不让她成为野指针，我们再释放p后，设p为NULL；
</span><span style="color:#75715e">//free(p);
</span><span style="color:#75715e">//p = NULL;
</span></code></pre></div><h3 id="5-reallocarray">5. reallocarray</h3>
<p>The reallocarray() function changes the size of the memory block pointed to by ptr to be large enough for an array of  nmemb  elements,
each of which is size bytes.  It is equivalent to the call</p>
<p><code>realloc(ptr, nmemb * size);</code>
However, unlike that realloc() call, reallocarray() fails safely in the case where the multiplication would overflow.  If such an over‐flow occurs, reallocarray() returns NULL, sets errno to ENOMEM, and leaves the original block of memory unchanged.</p>
<h3 id="为什么free不用传入malloc的内存的大小却可以正确的释放呢">为什么free不用传入malloc的内存的大小，却可以正确的释放呢？</h3>
<p>事实上我们malloc的时候，并不是严格按照我们指定的大小去申请的，而是有四个字节的头部存放，我们到底申请了多少内存，所以我们free的时候其实是去查看前面的四个字节，到底多大，再往后偏移的释放空间。</p>
<p>实际上你申请0的空间，他也不一定就是给你0的大小。</p>
<p>并且在cpp中，我们new[]一块空间，也不仅仅是new的空间，首部有4个字节存放，你new的对象个数，所以我们必须使用delete[]去释放，他会检查前面的4个字节，查看到底有多少个对象，再去释放。</p>
<p>​	TODO：详细捋一捋内存模型</p>

    </div>
</article>

        </main>
    </div><footer class="flex justify-center">
    <div class="copyright mx-auto my-8">
        <p>
            © 2018-2020 <a href="https://github.com/Bowser1704">Bowser1704</a> - <strong><a href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></strong> - <strong>Power By Hugo | Theme By hugo-w2ng</strong>
        </p>
        
    </div>
</footer>



<script src="//instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script></body>

</html>